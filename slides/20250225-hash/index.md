---
marp: true
theme: tanu
header: ""
footer: "© 2025 たぬ ( [@tanuhack](https://x.com/tanuhack) )"
paginate: true
---

<!-- _paginate: skip -->

# Data LT #3

## #️⃣ ハッシュ入門

and roots 株式会社 / グロースハックチーム

谷口 健太（Kenta Taniguchi）

---

## 自己紹介（もてぃのフォーマット丸パクリ）

<style>
.self-intro {
  display: flex;
  align-items: center;
  gap: 20px;
}

.self-intro img {
  width: 250px;
  border-radius: 50%;
}
</style>

<div class="self-intro">
  <img src="../tanu.jpg" alt="profile image">
  <div>
    <ul>
      <li><strong>名前:</strong> Kenta Taniguchi</li>
      <li><strong>会社:</strong> and roots株式会社</li>
      <li><strong>所属:</strong> グロースハックチーム 基盤グループ</li>
      <li><strong>職業:</strong> アナリティクスエンジニア</li>
      <li><strong>得意分野:</strong> データ全般</li>
      <li><strong>趣味:</strong> カレー、コーヒー、料理、ゲーム</li>
    </ul>
  </div>
</div>

---

# 🧑‍🏫 クイズ その 1

次の 2 つの文字列から生成されたハッシュ値は同じになるか？

1. `"Hello World"`
2. `"Hello world"`

---

# 🧑‍🏫 クイズ その 1 の解答

異なる！

1. `"Hello World"`: b10a8db164e0754105b7a99be72e3fe5
2. `"Hello world"`: 3e25960a79dbc69b674cd4ec67a72c62

わずか 1 文字の違い（`W` と `w`）でも、全く異なるハッシュ値になる。

---

# 👩‍🏫 クイズ その 2

次のうち、正しいハッシュ値の特徴はどれか？

1. 同じ入力からは必ず同じハッシュ値が生成される
2. ハッシュ値から元のデータを復元できる
3. ハッシュ値の長さは入力データの長さに比例する

---

# 👩‍🏫 クイズ その 2 の解答

1. 正しい
2. ハッシュ値から元のデータを復元できない
3. ハッシュ値の長さは固定長

---

# 👨‍🏫 クイズ その 3

パスワードの保存にハッシュ値を使う場合、単純なハッシュ化だけで十分か？

---

# 👨‍🏫 クイズ その 3 の解答

不十分！理由は後述します

---

# #️⃣ ハッシュ値とは

任意のデータから<span class="text-red-500">「固定長」</span>の値を生成する関数の出力。

特徴：

- 不可逆性（ハッシュ値から元のデータを復元できない）
- 雪崩効果（入力の小さな変化で出力が大きく変化する）
- 衝突耐性（異なる入力から同じ出力が出にくい）

---

## 📖 コラム「ハッシュ値は、データの指紋？」

<div class="text-2xs">

1. 一意性（固有性）
   - 指紋：人によって固有のパターンを持ち、同じ指紋を持つ人はいないとされる
   - ハッシュ値：同じ入力データからは必ず同じハッシュ値が生成される
2. サイズの一定性
   - 指紋：人の指の大きさに関係なく、指紋のパターンとして取り出すと一定のサイズになる
   - ハッシュ値：入力データのサイズに関係なく、出力されるハッシュ値の長さは一定
3. 照合の容易性
   - 指紋：データベースと照合することで、本人確認が容易にできる
   - ハッシュ値：元のデータから生成したハッシュ値と、保存されているハッシュ値を比較することで、データの同一性を簡単に確認できる
4. 改変検知
   - 指紋：傷や変形があると、それが検知できる
   - ハッシュ値：データの一部でも変更があると、全く異なるハッシュ値となる（雪崩効果）
5. 元データの推測困難性
   - 指紋：指紋の画像だけから、その人の容姿や特徴を推測することは困難
   - ハッシュ値：ハッシュ値から元のデータを復元することは実質的に不可能（不可逆性）

</div>

---

## 📖 コラム「ハッシュ化と暗号化の違い」

ハッシュ化：

- 一方向の変換
- 復元不可能
- データの整合性確認に使用

暗号化：

- 双方向の変換
- 復号可能
- データの機密性確保に使用

---

# 🎭 ハッシュ値の用途 1/2

個人情報（PII）や機密情報（CCI）のマスキング

<div class="text-2xs">

```
| user_id | name    | email               | password |
| ------- | ------- | ------------------- | -------- |
| 1       | Himmel  | himmel@example.com  | 12345678 |
| 2       | Frieren | frieren@example.com | 23456789 |
| 3       | Heiter  | heiter@example.com  | 34567890 |
| 4       | Eisen   | eisen@example.com   | 12345678 |
```

↓

```
| user_id | name                             | email                            | password                         |
| ------- | -------------------------------- | -------------------------------- | -------------------------------- |
| 1       | 1bb23a583cf7b04cd0774c727465cec9 | 6ebe7345304a4d7618c2292173f2f9d5 | 25d55ad283aa400af464c76d713c07ad |
| 2       | c8f51770ee5304c36edfc541c0f256f1 | fa3ee9852e866f5bdbe707c7a58b0147 | 4428c6c474502e61151877825bb41961 |
| 3       | 4b4fba7a88f14f6c41c0b89e377b489c | 0f5a20915de85dbe118cc3bd0d9c8269 | 3aad95d46a1ce1d2d1dd0cdb347604d9 |
| 4       | 5818b4b463d1ced9122edeae0da0787d | 44daeca0cd1691b1391aefc6077ec434 | 25d55ad283aa400af464c76d713c07ad |
```

</div>

---

## 📖 コラム「ハッシュ値の用途 1/2 の補足」

平文をハッシュ化しただけでは<span class="text-red-500">「レインボーテーブル攻撃」</span>に対して脆弱。

<div class="text-sm">

```
| password                               | hash                             |
| -------------------------------------- | -------------------------------- |
| password123                            | 482c811da5d5b4bc6d497ffa98491e38 |
| admin123                               | 0192023a7bbd73250516f069df18b500 |
| qwerty                                 | d8578edf8458ce06fbc5bb76a58c5ca4 |
| abc123                                 | e99a18c428cb38d5f260853678922e03 |
| （数百万～数億の一般的なパスワードのエントリ） |                                  |
```

攻撃者は上記のような対応表（レインボーテーブル）を事前に用意し、流出したハッシュ値と照合するだけで元の値を特定できる。

</div>

---

## 📖 コラム「レインボーテーブル攻撃の対策」

「salt」を使って、ハッシュ値を生成する。

<div class="text-sm">

```
| user_id | password                   | salt      |
| ------- | -------------------------- | --------- |
| 1       | hash(12345678 + tajkagas)  | tajkagas  |
| 2       | hash(23456789 + gakgnwak)  | gakgnwak  |
| 3       | hash(34567890 + wagjkaw)   | wagjkaw   |
| 4       | hash(12345678 + kgkkkabai) | kgkkkabai |
```

- salt は平文で保存してよい
- salt が漏れても、ハッシュ値から元のパスワードを現実的な時間で特定できない
  - e.g. 8 文字のパスワード（英数字のみ）の場合：
    - 候補数 = 62^8 （アルファベット大小文字 26×2 + 数字 10）= 約 218 兆通り
    - 1 秒間に 500 個のパスワードを試せる場合： 全パターンの試行に必要な時間 ≒ 13,800 年

</div>

---

# ⚖️ ハッシュ値の用途 2/2

Hashdiff（データ比較）

<div class="text-3xs">

```
| user_id | name    | magics     | hashdiff                         | load_ts    |
| ------- | ------- | ---------- | -------------------------------- | ---------- |
| 5       | Stark   | null       | d41f28b7b9dd3f01d677f0d846192fb3 | 2024-01-01 |
| 6       | Fern    | ゾルトラーク | 4fd70fecc3dd48d255d8c8b35285ed2c | 2024-01-01 |
```

↓ (データ追加)

```
| user_id | name    | magics                             | hashdiff                         | load_ts    |
| ------- | ------- | ---------------------------------- | -------------------------------- | ---------- |
| 5       | Stark   | null                               | d41f28b7b9dd3f01d677f0d846192fb3 | 2024-01-01 |
| 6       | Fern    | ゾルトラーク                         | 4fd70fecc3dd48d255d8c8b35285ed2c | 2024-01-01 |
| 5       | Stark   | null                               | d41f28b7b9dd3f01d677f0d846192fb3 | 2024-02-01 |
| 6       | Fern    | ゾルトラーク,服の汚れをきっぱり落とす魔法 | ea5d20a854282ae9b7c646b289ec634f | 2024-02-01 |
```

↓ (最新データのみを取得)

```
| user_id | name    | magics                             | hashdiff                         | load_ts    |
| ------- | ------- | ---------------------------------- | -------------------------------- | ---------- |
| 5       | Stark   | null                               | d41f28b7b9dd3f01d677f0d846192fb3 | 2024-01-01 |
| 6       | Fern    | ゾルトラーク,服の汚れをきっぱり落とす魔法 | ea5d20a854282ae9b7c646b289ec634f | 2024-02-01 |
```

</div>

---

# 🔢 よく使われるハッシュアルゴリズム

<div class="text-sm">

1. MD5（データ基盤ではこちらを採用しています。）
   - 128 ビット
   - 高速な処理が可能
   - データ整合性チェックや Hashdiff に最適
   - ※セキュリティ用途では非推奨
2. SHA-256
   - 256 ビット
   - 現在も広く使用
3. bcrypt
   - パスワード保存用
   - salt 組み込み済み

</div>

---

# まとめ

- ハッシュ値は「データの指紋」のような役割
  - 不可逆性（ハッシュ値から元のデータを復元できない）
  - 雪崩効果（入力の小さな変化で出力が大きく変化する）
  - 衝突耐性（異なる入力から同じ出力が出にくい）
- セキュリティ用途では必ず Salt を使用
- 用途に応じて適切なアルゴリズム（MD5, SHA-256, bcrypt）を選択
